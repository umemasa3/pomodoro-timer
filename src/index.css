@tailwind base;
@tailwind components;
@tailwind utilities;

@layer base {
  /* Core Web Vitals最適化: フォントの事前読み込み */
  html {
    font-family: 'Inter', system-ui, sans-serif;
    font-display: swap; /* フォント読み込み最適化 */
  }

  body {
    @apply bg-gray-50 dark:bg-gray-900 text-gray-900 dark:text-gray-100;
    @apply transition-colors duration-300;
    /* CLS防止: 最小高さを設定 */
    min-height: 100vh;
    /* LCP最適化: 重要なスタイルを最初に適用 */
    contain: layout style paint;
  }

  /* Core Web Vitals最適化: 重要な要素のサイズ固定 */
  .critical-content {
    min-height: 400px;
    contain: layout;
  }

  /* CLS防止: 画像のアスペクト比固定 */
  .aspect-ratio-container {
    position: relative;
    width: 100%;
    height: 0;
  }

  .aspect-ratio-container img {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    object-fit: cover;
  }

  /* FID最適化: インタラクティブ要素の応答性向上 */
  button,
  [role='button'] {
    touch-action: manipulation;
    user-select: none;
  }

  /* LCP最適化: 重要なテキストの可視性確保 */
  .text-critical {
    font-display: block;
    text-rendering: optimizeSpeed;
  }

  /* フォントサイズ設定 */
  .font-small {
    font-size: 14px;
  }

  .font-medium {
    font-size: 16px;
  }

  .font-large {
    font-size: 18px;
  }

  /* ハイコントラスト設定 */
  .high-contrast {
    --tw-contrast: contrast(1.5);
    filter: var(--tw-contrast);
  }

  .high-contrast .text-gray-500 {
    @apply text-gray-700 dark:text-gray-300;
  }

  .high-contrast .text-gray-400 {
    @apply text-gray-600 dark:text-gray-200;
  }

  /* モーション軽減設定 */
  .reduced-motion * {
    animation-duration: 0.01ms !important;
    animation-iteration-count: 1 !important;
    transition-duration: 0.01ms !important;
  }

  /* Core Web Vitals最適化: アニメーションの最適化 */
  @media (prefers-reduced-motion: no-preference) {
    .optimized-animation {
      will-change: transform, opacity;
      transform: translateZ(0); /* ハードウェアアクセラレーション */
    }
  }

  /* カラーモード別のCSS変数 */
  .color-focus {
    --primary-50: theme('colors.focus.50');
    --primary-100: theme('colors.focus.100');
    --primary-200: theme('colors.focus.200');
    --primary-300: theme('colors.focus.300');
    --primary-400: theme('colors.focus.400');
    --primary-500: theme('colors.focus.500');
    --primary-600: theme('colors.focus.600');
    --primary-700: theme('colors.focus.700');
    --primary-800: theme('colors.focus.800');
    --primary-900: theme('colors.focus.900');
  }

  .color-calm {
    --primary-50: theme('colors.calm.50');
    --primary-100: theme('colors.calm.100');
    --primary-200: theme('colors.calm.200');
    --primary-300: theme('colors.calm.300');
    --primary-400: theme('colors.calm.400');
    --primary-500: theme('colors.calm.500');
    --primary-600: theme('colors.calm.600');
    --primary-700: theme('colors.calm.700');
    --primary-800: theme('colors.calm.800');
    --primary-900: theme('colors.calm.900');
  }

  .color-energy {
    --primary-50: theme('colors.energy.50');
    --primary-100: theme('colors.energy.100');
    --primary-200: theme('colors.energy.200');
    --primary-300: theme('colors.energy.300');
    --primary-400: theme('colors.energy.400');
    --primary-500: theme('colors.energy.500');
    --primary-600: theme('colors.energy.600');
    --primary-700: theme('colors.energy.700');
    --primary-800: theme('colors.energy.800');
    --primary-900: theme('colors.energy.900');
  }

  .color-nature {
    --primary-50: theme('colors.nature.50');
    --primary-100: theme('colors.nature.100');
    --primary-200: theme('colors.nature.200');
    --primary-300: theme('colors.nature.300');
    --primary-400: theme('colors.nature.400');
    --primary-500: theme('colors.nature.500');
    --primary-600: theme('colors.nature.600');
    --primary-700: theme('colors.nature.700');
    --primary-800: theme('colors.nature.800');
    --primary-900: theme('colors.nature.900');
  }
}

@layer components {
  /* ポモドーロタイマー専用コンポーネントスタイル */
  .timer-circle {
    @apply relative w-80 h-80 rounded-full;
    background: linear-gradient(
      135deg,
      var(--primary-400),
      var(--primary-500),
      var(--primary-600)
    );
    @apply shadow-2xl;
    box-shadow: 0 25px 50px -12px rgb(var(--primary-500) / 0.25);
    @apply transition-all duration-700 ease-in-out;
    @apply border-4 border-white/20;
  }

  /* レスポンシブ対応のタイマーサークル */
  @media (max-width: 640px) {
    .timer-circle {
      @apply w-64 h-64;
    }
  }

  @media (max-width: 480px) {
    .timer-circle {
      @apply w-56 h-56;
    }
  }

  .timer-circle.break-mode {
    background: linear-gradient(
      135deg,
      var(--primary-400),
      var(--primary-500),
      var(--primary-600)
    );
  }

  .timer-circle::before {
    content: '';
    @apply absolute inset-2 rounded-full;
    background: linear-gradient(
      135deg,
      rgba(255, 255, 255, 0.1) 0%,
      rgba(255, 255, 255, 0.05) 100%
    );
    backdrop-filter: blur(10px);
  }

  .timer-progress {
    @apply absolute inset-0 rounded-full;
    background: conic-gradient(
      from 0deg,
      transparent 0deg,
      rgba(255, 255, 255, 0.3) 0deg,
      transparent 0deg
    );
    transition: all 0.3s ease-in-out;
  }

  .btn-primary {
    @apply px-8 py-4;
    background: linear-gradient(
      to right,
      var(--primary-500),
      var(--primary-600)
    );
    @apply text-white font-semibold rounded-xl;
    @apply transition-all duration-300 ease-in-out;
    @apply shadow-lg hover:shadow-xl;
    box-shadow: 0 10px 25px -5px rgb(var(--primary-500) / 0.25);
    @apply focus:outline-none focus:ring-2 focus:ring-offset-2;
    @apply transform hover:scale-105 active:scale-95;
    border: 1px solid rgb(var(--primary-400) / 0.5);
  }

  .btn-primary:hover {
    background: linear-gradient(
      to right,
      var(--primary-600),
      var(--primary-700)
    );
    box-shadow: 0 20px 40px -10px rgb(var(--primary-500) / 0.35);
  }

  .btn-primary:focus {
    --tw-ring-color: var(--primary-500);
  }

  /* レスポンシブ対応のボタン */
  @media (max-width: 640px) {
    .btn-primary {
      @apply px-6 py-3 text-sm;
    }
  }

  .btn-secondary {
    @apply px-8 py-4 bg-gradient-to-r from-gray-100 to-gray-200;
    @apply dark:from-gray-700 dark:to-gray-600;
    @apply hover:from-gray-200 hover:to-gray-300;
    @apply dark:hover:from-gray-600 dark:hover:to-gray-500;
    @apply text-gray-800 dark:text-gray-200 font-semibold rounded-xl;
    @apply transition-all duration-300 ease-in-out;
    @apply shadow-lg hover:shadow-xl;
    @apply focus:outline-none focus:ring-2 focus:ring-gray-500 focus:ring-offset-2;
    @apply transform hover:scale-105 active:scale-95;
    @apply border border-gray-300/50 dark:border-gray-600/50;
  }

  /* レスポンシブ対応のセカンダリボタン */
  @media (max-width: 640px) {
    .btn-secondary {
      @apply px-6 py-3 text-sm;
    }
  }

  .btn-ghost {
    @apply px-6 py-3 bg-transparent;
    @apply text-gray-600 dark:text-gray-400;
    @apply hover:text-gray-800 dark:hover:text-gray-200;
    @apply hover:bg-gray-100 dark:hover:bg-gray-800;
    @apply font-medium rounded-lg;
    @apply transition-all duration-200 ease-in-out;
    @apply focus:outline-none focus:ring-2 focus:ring-gray-500 focus:ring-offset-2;
  }

  .card {
    @apply bg-white/80 dark:bg-gray-800/80 rounded-2xl shadow-xl;
    @apply border border-gray-200/50 dark:border-gray-700/50;
    @apply backdrop-blur-sm;
    @apply transition-all duration-300 ease-in-out;
    background: linear-gradient(
      135deg,
      rgba(255, 255, 255, 0.9) 0%,
      rgba(255, 255, 255, 0.8) 100%
    );
  }

  .dark .card {
    background: linear-gradient(
      135deg,
      rgba(31, 41, 55, 0.9) 0%,
      rgba(31, 41, 55, 0.8) 100%
    );
  }

  .card:hover {
    @apply shadow-2xl transform translate-y-[-4px];
    @apply border-gray-300/60 dark:border-gray-600/60;
  }

  /* レスポンシブ対応のカード */
  @media (max-width: 640px) {
    .card {
      @apply rounded-xl;
    }
  }

  .card-glass {
    @apply bg-white/10 dark:bg-gray-900/10;
    @apply backdrop-blur-md border border-white/20 dark:border-gray-700/20;
    @apply rounded-2xl shadow-xl;
    @apply transition-all duration-300 ease-in-out;
  }

  .card-glass:hover {
    @apply bg-white/20 dark:bg-gray-900/20;
    @apply border-white/30 dark:border-gray-600/30;
  }

  .toggle {
    @apply relative inline-flex h-7 w-12 items-center rounded-full;
    @apply bg-gray-200 dark:bg-gray-700;
    @apply transition-all duration-300 ease-in-out;
    @apply focus:outline-none focus:ring-2 focus:ring-offset-2;
    --tw-ring-color: var(--primary-500);
    @apply cursor-pointer shadow-inner;
  }

  .toggle:checked {
    background: linear-gradient(
      to right,
      var(--primary-500),
      var(--primary-600)
    );
    box-shadow: 0 4px 12px rgb(var(--primary-500) / 0.25);
  }

  .toggle::before {
    @apply absolute left-1 top-1 h-5 w-5 rounded-full bg-white;
    @apply transition-all duration-300 ease-in-out;
    @apply shadow-md;
    content: '';
  }

  .toggle:checked::before {
    @apply translate-x-5;
    @apply shadow-lg;
  }

  .floating-element {
    @apply animate-float;
  }

  .glow-effect {
    @apply relative;
  }

  .glow-effect::before {
    content: '';
    @apply absolute inset-0 rounded-full;
    background: linear-gradient(
      to right,
      var(--primary-400),
      var(--primary-600)
    );
    @apply opacity-20 blur-xl scale-110;
    @apply animate-pulse-slow;
  }

  .glass-morphism {
    background: rgba(255, 255, 255, 0.1);
    backdrop-filter: blur(10px);
    border: 1px solid rgba(255, 255, 255, 0.2);
  }

  .dark .glass-morphism {
    background: rgba(0, 0, 0, 0.1);
    border: 1px solid rgba(255, 255, 255, 0.1);
  }

  .gradient-text {
    background: linear-gradient(
      to right,
      var(--primary-500),
      var(--primary-700)
    );
    @apply bg-clip-text text-transparent;
  }

  .break-gradient-text {
    background: linear-gradient(
      to right,
      var(--primary-500),
      var(--primary-700)
    );
    @apply bg-clip-text text-transparent;
  }

  .shimmer {
    background: linear-gradient(
      90deg,
      transparent,
      rgba(255, 255, 255, 0.4),
      transparent
    );
    animation: shimmer 2s infinite;
  }

  @keyframes shimmer {
    0% {
      transform: translateX(-100%);
    }
    100% {
      transform: translateX(100%);
    }
  }

  .progress-ring {
    @apply transition-all duration-300 ease-in-out;
    transform-origin: center;
  }

  .session-indicator {
    @apply w-3 h-3 rounded-full;
    @apply transition-all duration-300 ease-in-out;
    @apply shadow-sm;
  }

  .session-indicator.completed {
    background: linear-gradient(
      to right,
      var(--primary-400),
      var(--primary-600)
    );
    box-shadow: 0 2px 8px rgb(var(--primary-500) / 0.25);
  }

  .session-indicator.pending {
    @apply bg-gray-200 dark:bg-gray-700;
    @apply border-2 border-gray-300 dark:border-gray-600;
  }

  /* レスポンシブ対応のユーティリティクラス */
  .responsive-grid {
    @apply grid grid-cols-1 gap-4;
  }

  @media (min-width: 640px) {
    .responsive-grid {
      @apply grid-cols-2;
    }
  }

  @media (min-width: 1024px) {
    .responsive-grid {
      @apply grid-cols-3;
    }
  }

  @media (min-width: 1280px) {
    .responsive-grid {
      @apply grid-cols-4;
    }
  }

  /* タッチデバイス対応 */
  @media (hover: none) and (pointer: coarse) {
    .btn-primary:hover,
    .btn-secondary:hover,
    .card:hover {
      transform: none;
    }

    .btn-primary,
    .btn-secondary {
      @apply py-4;
      min-height: 44px; /* タッチターゲットの最小サイズ */
    }
  }

  /* プリント対応 */
  @media print {
    .timer-circle,
    .floating-element,
    .glow-effect {
      @apply shadow-none;
      background: white !important;
      color: black !important;
    }

    .card {
      @apply border border-gray-300;
      background: white !important;
    }
  }
}

/* アクセシビリティ対応のフォーカススタイル */
@layer utilities {
  .focus-visible-ring {
    @apply focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-offset-2;
    --tw-ring-color: var(--primary-500);
  }

  /* スクリーンリーダー専用テキスト */
  .sr-only-focusable {
    @apply sr-only;
  }

  .sr-only-focusable:focus {
    @apply not-sr-only absolute z-50 p-2 bg-white text-black rounded;
  }
}
